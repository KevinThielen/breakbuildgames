<!DOCTYPE html>
<html lang="en-US">
<head>
  <script src="https://breakbuild.dev/theme.min.js" integrity="sha384-IpIaa84kOKgkF5EJ0fD/kBe2wtIIsIB60ANGmuJxeA0dz5bSRfwBwp2/QybtQpU2"></script>
  <link rel="stylesheet" href="https://breakbuild.dev/abridge-switcher.css?h=c850f5392cbd40b6d06752342d3fd5ceefa08d529af137d89832f0456e26ff53" />
  <link rel="stylesheet" href="https://breakbuild.dev/admonition.css?h=4f1563f2b8b131b01eee4c96c3b24251cb33fdc554a2f32e4fc318bd0003b61b" />
  <link rel="stylesheet" href="https://breakbuild.dev/bb_theme.css?h=44a9366bb950a993c71b7a48aa821f3f8158e79071f5e54837481ab9d9fe009d" />
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <script defer src="https://breakbuild.dev/abridge-bundle.min.js?h=37498d9c4974c65842b240d9f1cef717c2795597e3b707943dd94a29747139ac" integrity="sha384-2H4hnvq/t69174LPq4L1BX6QutFOgSDmKluRZQMzNjNn93Eu67vH7wtZCeCelqL3"></script>
  <meta name="base" content="https://breakbuild.dev" />
  <link rel="alternate" type="application/atom+xml" title="Atom/RSS Feed" href="https://breakbuild.dev/atom.xml" />
  
 
  
      
  

  <meta name="robots" content="index, follow" />
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
  <title>The GL Context | BreakBuildGames</title>
  <meta name="author" content="Kevin" />
  <meta name="copyright" content="BreakBuildGames" />
  <meta name="description" content="The first abstraction is for the context itself. It is going to be the core of our crate." />
  <link rel="canonical" href="https://breakbuild.dev/devlog/renderer/hello_triangle_v2/gl-context/" />
  <meta name="keywords" content="Triangle, Context, BreakBuildGames, Rust, GameDev, Devlog, OpenGL, Graphics Programming, Blog, Game Development" />
  <meta property="og:url" content="https://breakbuild.dev/devlog/renderer/hello_triangle_v2/gl-context/" />
  <meta name="twitter:url" content="https://breakbuild.dev/devlog/renderer/hello_triangle_v2/gl-context/" />
  <meta property="og:description" content="The first abstraction is for the context itself. It is going to be the core of our crate." />
  <meta name="twitter:description" content="The first abstraction is for the context itself. It is going to be the core of our crate." />
  <meta property="og:title" content="The GL Context | BreakBuildGames" />
  <meta name="twitter:title" content="The GL Context | BreakBuildGames" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:image" content="https://breakbuild.dev/banner.png" />
  <meta property="og:image" content="https://breakbuild.dev/banner.png" />
  <meta property="og:site_name" content="BreakBuildGames" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:type" content="website" />
  <meta property="og:updated_time" content="2022-12-07" />
  <meta name="twitter:site" content="@GenusNymphicus" />
  <meta name="twitter:creator" content="@GenusNymphicus" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="theme-color" content="#333333" />
  <meta name="msapplication-TileColor" content="#333333" />
  <link rel="manifest" href="https://breakbuild.dev/site.webmanifest" />
  <link rel="mask-icon" href="https://breakbuild.dev/logo.svg" color="#ff9900" />
  <link rel="apple-touch-icon" sizes="180x180" href="https://breakbuild.dev/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="https://breakbuild.dev/favicon32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="https://breakbuild.dev/favicon16.png" />
  <noscript><link rel="stylesheet" href="https://breakbuild.dev/nojs.css" /></noscript>
</head>
<body>
  <header>
    <nav>
      <div><h1><a href="https://breakbuild.dev/"><img src="https://breakbuild.dev/logo.svg" alt="BreakBuildGames" width="160" height="128" /></a></h1></div>
      <div>
        <ul><li> <h2><a href="https://breakbuild.dev">About</a></h2> </li><li> <h2><a href="https://breakbuild.dev/blog/">Blog</a></h2> </li><li> <h2><a href="https://breakbuild.dev/devlog/">Devlog</a></h2> </li><li> <h2><a href="https://breakbuild.dev/support/">Support</a></h2> </li><li> <h2><a href="https://breakbuild.dev/tags/">Tags</a></h2> </li><li class="js"><i type="reset" id="mode" class="svgs adjust"></i></li></ul>
      </div>
      <div>
        <form autocomplete=off class="js" name="goSearch" id="searchbox">
          <div class="searchd">
            <input id="searchinput" type="text" placeholder="Search" title="Search" />
            <button type="submit" title="Search"><i class="svgs search"></i></button>
          </div>
          <div><div id="suggestions"></div></div>
        </form>
      </div>
    </nav>
  </header>
  <main>

    








    


    

    

    

    
          
     
         
        

    

    

    

    
          
     
         
         
         
        
       
        

        

        
              
         
         
        
       
        

        

        
              
        

    

    

    

    
          
     
         
         
         
        
       
        

        

        
              
         
         
        
       
        

        

        
              
         
         
        
       
        

        

        
              
        

    

    

    

    
          
     
         
         
         
        
       
        

        
            
            
        

         
         
        
       
        
            
        

        

         
         
        
       
        

        

         
         
        
       
        

        

        

<article>
    <h1>The GL Context</h1>
        <span class="s95"> Kevin<span class="hpad">|</span> 7 min read<span class="hpad">|</span> December 07, 2022<span class="hpad">|</span> [<a href="https://breakbuild.dev/categories/devlog/">Devlog</a>] #<a href="https://breakbuild.dev/tags/opengl/">OpenGL</a>  #<a href="https://breakbuild.dev/tags/context/">Context</a>  #<a href="https://breakbuild.dev/tags/renderer/">Renderer</a> </span>
    <p>The first thing we have to think about is our context itself.</p>
<p>Do we want the ability to select it during runtime, or is hard-wiring it during
compilation fine?</p>
<p>Is there a closed set of contexts, or should there be the
ability to potentially create specialized contexts from the outside? </p>
<p>Then there is the whole mess with the global state machine and binding 
resources, which are more or less unique to OpenGL.</p>
<p>There are dozens of questions, some more relevant than others. Many of them
could be answered with <code>YAGNI</code>(&quot;You Aren't Gonna Need It&quot;), at least right now.
We start simple, then try to figure out if/how it works out with some more
advanced examples.</p>
<p>Also, just because we go with one approach doesn't mean we can't adjust our
architecture down the road. In fact, it is almost guaranteed.</p>
<p>After a bit of back and forth and sketching different approaches in our
playground, we decide that it is fine to have the context being defined during
compile time. Rust's amazing enums will allow us to use static dispatch later as
well, so it will be no problem to define fallback backends. 
The compile time approach has the benefit that we can have per-implementation
configurations. Our OpenGL context for example can require anything with a
proc-address to load the function pointers, while <code>wgpu</code> is fine with something
that uses <code>raw-window-handle</code>.</p>
<p>So, let's start with the simplest thing first. We define an OpenGL
context.</p>
<p>So we add the file opengl.rs to the src of our context, to create out &quot;OpenGL
Context&quot;</p>
<div class="code_with_header">
<div class="codeheader">cac_graphics/context/src/opengl.rs</div>
<pre data-lang="rust" class="language-rust z-code"><code class="language-rust" data-lang="rust"><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">Context</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre>
</div>
<p>My ability to name things is laughable, so feel free to use whatever
name you prefer. To follow Rust's
<a rel="noopener" target="_blank" href="https://rust-lang.github.io/api-guidelines/checklist.html">API-Guidelines</a>, we avoid the &quot;OpenGL&quot; prefix for this struct, since it's already the module name.</p>
<p>Let's not forget to add this module to our lib.rs:</p>
<div class="code_with_header">
<div class="codeheader">cac_graphics/context/src/lib.rs</div>
<pre data-lang="rust" class="language-rust z-code"><code class="language-rust" data-lang="rust"><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-module z-rust">mod</span> <span class="z-entity z-name z-module z-rust">opengl</span><span class="z-punctuation z-terminator z-rust">;</span></span>
</span></code></pre>
</div>
<p>The creation of a window and the actual OpenGL-context are closely related, and
on certain platforms, the window has to be created with specific GL attributes
in mind.</p>
<p>For that reason, we only require the bare necessities to create our graphics
context and let the user pick whatever window / OpenGL context creation
combination they want. We used <code>winit</code> and <code>raw-gl-context</code> in our playground, but anything that allows
us to load OpenGL functions should work, for example <code>glutin</code>, <code>glfw</code>, or <code>SDL2</code>.
This has the huge benefit that the OpenGL abstraction is completely platform
independent. We can always add abstraction layers for the GLContext later, or
just integrate the common ones via feature flags.</p>
<p>There is an argument to be made to make our graphics Context take ownership
of the GLContext, to make sure our own context will not outlive the GLContext.
This is less about the function pointers, but more about the OpenGL objects
having their lifetimes being tied to the context itself. Taking ownership of the
GLContext means that our own Context also takes ownership over the GL objects!</p>
<p>There are other ways to archive this, but we are probably never going to do anything else but calling swap buffers on the
gl_context. Maybe making it (not) current later, but making the changes for that
are trivial.</p>
<p>So with this in mind, we abstract the GLContext via a trait and store it in our
graphics Context via a generic:</p>
<div class="code_with_header">
<div class="codeheader">cac_graphics/contest/src/opengl.rs</div>
<pre data-lang="rust" class="language-rust z-code"><code class="language-rust" data-lang="rust"><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-keyword z-other z-rust">crate</span><span class="z-meta z-path z-rust"><span class="z-punctuation z-accessor z-rust">::</span></span>gl43_core <span class="z-keyword z-operator z-rust">as</span> gl<span class="z-punctuation z-terminator z-rust">;</span>

<span class="z-meta z-trait z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-trait z-rust">trait</span> <span class="z-entity z-name z-trait z-rust">GLContext</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">swap_buffers</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&amp;</span><span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">self</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-punctuation z-terminator z-rust">;</span>
    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">get_proc_address</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&amp;</span><span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">self</span>, <span class="z-variable z-parameter z-rust">name</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&amp;</span><span class="z-storage z-modifier z-lifetime z-rust">&#39;static</span> <span class="z-storage z-type z-rust">str</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-&gt;</span> <span class="z-storage z-modifier z-rust">*const</span> <span class="z-meta z-path z-rust">std<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">ffi<span class="z-punctuation z-accessor z-rust">::</span></span>c_void</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>

<span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-generic z-rust"><span class="z-entity z-name z-struct z-rust">Context</span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span>C<span class="z-punctuation z-separator z-rust">:</span> GLContext<span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span></span></span><span class="z-meta z-struct z-rust"> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
    <span class="z-variable z-other z-member z-rust">gl_context</span><span class="z-punctuation z-separator z-type z-rust">:</span> C,
</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>

<span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span></span><span class="z-meta z-impl z-rust"><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span>C<span class="z-punctuation z-separator z-rust">:</span> GLContext<span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span></span><span class="z-meta z-impl z-rust"> <span class="z-entity z-name z-impl z-rust">Context</span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span>C<span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">new</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">context</span><span class="z-punctuation z-separator z-rust">:</span> C</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-&gt;</span> <span class="z-storage z-type z-rust">Self</span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
        <span class="z-meta z-path z-rust">gl<span class="z-punctuation z-accessor z-rust">::</span></span>load_with<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-variable z-parameter z-rust">name</span><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust">context<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">get_proc_address</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>name</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
        <span class="z-storage z-type z-rust">Self</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
            gl_context<span class="z-punctuation z-separator z-rust">:</span> context<span class="z-punctuation z-separator z-rust">,</span>
        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>

    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">update</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&amp;</span><span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">self</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
        <span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span>gl_context<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">swap_buffers</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre>
<p>Technically, our trait function and also the <code>update()</code> function don't have to take a mutable self
right now. However, we use the power of foresight to know that we will
definitely fiddle with the context state here at some point, and we also assume
that some context implementations treat swap_buffers as a mutable operation.</p>
<p>Now we need to adjust our playground.rs.
Our playground sees our own crate as an external one, which is the point of examples.
They should show how you use the crate from the point of view of a user.
Since we are making the abstraction via a trait, and we want the external
<code>raw-gl-context</code> to implement that trait, we are violating the orphan rule. </p>
<pre data-lang="rust" class="language-rust z-code"><code class="language-rust" data-lang="rust"><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-path z-rust">opengl<span class="z-punctuation z-accessor z-rust">::</span></span>GLContext <span class="z-keyword z-other z-rust">for</span></span><span class="z-meta z-impl z-rust"> <span class="z-entity z-name z-impl z-rust">GlContext</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>  
<span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Error: only traits defined in the current crate can be
</span><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> implemented for types defined outside of the crate
</span><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> define and implement a trait or new type instead
</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span> 
</span></code></pre>
<p>This rule prevents us implementing external traits on external structs. The
reason for that is that two crates could implement the same trait on the same
struct with different implementations, and the compiler wouldn't know which one to pick.</p>
<p>Rust's error messages are useful as always and tell us the solution without a
spoiler warning. We need to use the <a rel="noopener" target="_blank" href="https://doc.rust-lang.org/rust-by-example/generics/new_types.html">New Type Idiom</a>.
It's just a tuple struct wrapping our intended struct. It's now our own type,
containing the external one.</p>
<pre data-lang="rust" class="language-rust z-code"><code class="language-rust" data-lang="rust"><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">GLContext</span></span><span class="z-meta z-struct z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>GlContext</span><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre>
<p>Now we can implement the trait for our new type: </p>
<pre data-lang="rust" class="language-rust z-code"><code class="language-rust" data-lang="rust"><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-path z-rust">context<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">opengl<span class="z-punctuation z-accessor z-rust">::</span></span>GLContext <span class="z-keyword z-other z-rust">for</span></span><span class="z-meta z-impl z-rust"> <span class="z-entity z-name z-impl z-rust">GLContext</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">swap_buffers</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&amp;</span><span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">self</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
        <span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-constant z-numeric z-float z-rust">0.</span><span class="z-support z-function z-rust">swap_buffers</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>

    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">get_proc_address</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&amp;</span><span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">self</span>, <span class="z-variable z-parameter z-rust">name</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&amp;</span><span class="z-storage z-modifier z-lifetime z-rust">&#39;static</span> <span class="z-storage z-type z-rust">str</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-&gt;</span> <span class="z-storage z-modifier z-rust">*const</span> <span class="z-meta z-path z-rust">std<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">ffi<span class="z-punctuation z-accessor z-rust">::</span></span>c_void</span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
        <span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-constant z-numeric z-float z-rust">0.</span><span class="z-support z-function z-rust">get_proc_address</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>name</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre>
<p>And adjust our <code>main</code>: </p>
<p>{% code(name=&quot;cac_graphics/context/examples/playground.rs&quot;) %}</p>
<pre data-lang="rust" class="language-rust z-code"><code class="language-rust" data-lang="rust"><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">context<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>gl43_core <span class="z-keyword z-operator z-rust">as</span> gl<span class="z-punctuation z-separator z-rust">,</span> opengl</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-terminator z-rust">;</span>

<span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span>..
</span>
<span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span>create a context from the existing winit window
</span><span class="z-storage z-type z-rust">let</span> gl_context <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">GlContext<span class="z-punctuation z-accessor z-rust">::</span></span>create<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
    <span class="z-keyword z-operator z-bitwise z-rust">&amp;</span>window<span class="z-punctuation z-separator z-rust">,</span>
    <span class="z-meta z-path z-rust">raw_gl_context<span class="z-punctuation z-accessor z-rust">::</span></span>GlConfig <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
        alpha_bits<span class="z-punctuation z-separator z-rust">:</span> <span class="z-constant z-numeric z-integer z-decimal z-rust">0</span><span class="z-punctuation z-separator z-rust">,</span>
        version<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-integer z-decimal z-rust">4</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-constant z-numeric z-integer z-decimal z-rust">3</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
        profile<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-path z-rust">raw_gl_context<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">Profile<span class="z-punctuation z-accessor z-rust">::</span></span>Core<span class="z-punctuation z-separator z-rust">,</span>
        <span class="z-keyword z-operator z-range z-rust">..</span><span class="z-support z-type z-rust">Default</span><span class="z-meta z-path z-rust"><span class="z-punctuation z-accessor z-rust">::</span></span>default<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">unwrap</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
gl_context<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">make_current</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
<span class="z-storage z-type z-rust">let</span> gl_context <span class="z-keyword z-operator z-assignment z-rust">=</span> GLContext<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>gl_context</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>

<span class="z-storage z-type z-rust">let</span> <span class="z-storage z-modifier z-rust">mut</span> context <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">opengl<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">Context<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>gl_context</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>

<span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span>..
</span>
<span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> replace gl_context.swap_buffers() in the event_loop with 
</span>context<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">update</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre>
</div>
<p>Running it shows that everything is dandy.</p>
<p>Our solution has the advantage that our context can control when
<code>swap_buffers()</code> should happen, so that it can do calls before and after it(important
because of the implicit <code>glFinish</code> in swap_buffers). Granted, it is a bit verbose, but we can
just implement the trait for specific context crates later, avoid the New Type
and put them behind a feature flag.</p>
<p>However, certain context implementations treat the context just as a global, and
there is not a lot we can do about that, except praying that the GLContext will
always outlive ours(spoiler, it won't. Changing the window mode is
usually enough to destroy the context). We could fiddle with some check that
probes whether an object still exists and then invalidate all &quot;references&quot; to the
objects, but for now, let us just avoid this stuff.</p>
<p>Some other context implementations tie the GLContext to a window(e.g. <code>glfw-rs</code>),
and we really don't want to deal with Window nonsense in our context.
Some things might make sense, a window is just like a canvas after all, but taking control of the main loop or dealing with
input and device events are definitely out of the scope of a small render
context. We are going to try glfw soon, to check if our abstraction works.</p>
<p>So far, we just created the context without any validations, so let's change that. 
Now is also a great time to start with proper Error-types.</p>
<p>At this point, adding all the source files at the bottom of
every page, is becoming a bit too cumbersome. So I will just add the link to the
repository with the code from now on.</p>
<hr />
<p><a rel="noopener" target="_blank" href="https://github.com/KevinThielen/cac_graphics/tree/9eb2180f154de2bdb275a5515eeee65a128a1796">Link to the
repository</a></p>


<nav>
    
    <a class="previous" href="https:&#x2F;&#x2F;breakbuild.dev&#x2F;devlog&#x2F;renderer&#x2F;hello_triangle_v2&#x2F;">←</a>
    
    <span style="padding-left: 2rem; padding-right: 2rem">
        10 / 13
    </span>
    
    <a class="next" href="https:&#x2F;&#x2F;breakbuild.dev&#x2F;devlog&#x2F;renderer&#x2F;hello_triangle_v2&#x2F;error-handling&#x2F;">→</a>
    
</nav>

</article>



<div class="toc" aria-hidden="true">
  <div class="toc-sticky">
    <div class="toc-item">

        
            <a class = "chapter_header" href="https://breakbuild.dev/devlog/renderer/">Writing the Renderer</a>
        

        
            <div class="toc-item header">
                
                    <a href="https://breakbuild.dev/devlog/renderer/project_setup/">1 Project Setup</a> 
                
            </div>
            
             
                 
                
        
            <div class="toc-item header">
                
                    <a href="https://breakbuild.dev/devlog/renderer/the_context/">2 The Context</a> 
                
            </div>
            
             
                 
                 
                 

                <div class="toc-item-child">
                
                    <a href="https://breakbuild.dev/devlog/renderer/the_context/opengl/">2.1 OpenGL</a> 
                
                </div>
                
             
                 

                <div class="toc-item-child">
                
                    <a href="https://breakbuild.dev/devlog/renderer/the_context/handwritten-bindings/">2.2 [Excursion] Handwritten GL Bindings</a> 
                
                </div>
                
            
        
            <div class="toc-item header">
                
                    <a href="https://breakbuild.dev/devlog/renderer/hello_triangle/">3 Hello Triangle</a> 
                
            </div>
            
             
                 
                 
                 

                <div class="toc-item-child">
                
                    <a href="https://breakbuild.dev/devlog/renderer/hello_triangle/buffers/">3.1 Buffers</a> 
                
                </div>
                
             
                 

                <div class="toc-item-child">
                
                    <a href="https://breakbuild.dev/devlog/renderer/hello_triangle/vertex-attributes/">3.2 Vertex Attributes</a> 
                
                </div>
                
             
                 

                <div class="toc-item-child">
                
                    <a href="https://breakbuild.dev/devlog/renderer/hello_triangle/shaders/">3.3 Shaders</a> 
                
                </div>
                
            
        
            <div class="toc-item header">
                
                    <a href="https://breakbuild.dev/devlog/renderer/hello_triangle_v2/">4 Hello Triangle V2</a> 
                
            </div>
            
             
                 
                 
                 

                <div class="toc-item-child">
                
                    <a class="chapter" href="https://breakbuild.dev/devlog/renderer/hello_triangle_v2/gl-context/">4.1 The GL Context</a> 
                    
                
                </div>
                
             
                 

                <div class="toc-item-child">
                
                    <a href="https://breakbuild.dev/devlog/renderer/hello_triangle_v2/error-handling/">4.2 Error Handling</a> 
                
                </div>
                
             
                 

                <div class="toc-item-child">
                
                    <a href="https://breakbuild.dev/devlog/renderer/hello_triangle_v2/alternative-contex/">4.3 GLFW</a> 
                
                </div>
                
             
                 

                <div class="toc-item-child">
                
                    <a href="https://breakbuild.dev/devlog/renderer/hello_triangle_v2/render-target/">4.4 RenderTargets</a> 
                
                </div>
                
            
        

    <nav>
        
        <a class="previous" href="https:&#x2F;&#x2F;breakbuild.dev&#x2F;devlog&#x2F;renderer&#x2F;hello_triangle_v2&#x2F;">←</a>
        
        <span style="padding-left: 2rem; padding-right: 2rem">
            10 / 13
        </span>
        
        <a class="next" href="https:&#x2F;&#x2F;breakbuild.dev&#x2F;devlog&#x2F;renderer&#x2F;hello_triangle_v2&#x2F;error-handling&#x2F;">→</a>
        
    </nav>
  </div>
</div>
  </main>
  <footer>
    <hr />
    <div class="c">
      <nav>
        <ul><li><a href="https://breakbuild.dev/atom.xml" target="_blank" title="Atom/RSS Feed"><i type="Button" class="svg rss" title="Atom/RSS Feed"></i></a></li><li class="js"><a class="m-protected" href="#Z2VudXNueW1waGljdXNAZ21haWwuY29t" target="_blank" title="Mail"><i type="Button" class="svg mail" title="Mail"></i></a></li><li><a href="https://twitter.com/GenusNymphicus/" target="_blank" title="Twitter"><i type="Button" class="svg twitter" title="Twitter"></i></a></li><li><a href="https://github.com/KevinThielen/" target="_blank" title="Github"><i type="Button" class="svg github" title="Github"></i></a></li><li><a href="https://www.buymeacoffee.com/genusnymph/" target="_blank" title="Buy Me A Coffee"><i type="Button" class="svg buymeacoffee" title="Buy Me A Coffee"></i></a></li></ul>
      </nav>
      <p class="s90">Copyright &copy; 2022 BreakBuildGames</p>
      <nav>
        <ul><li class="s90"> <a href="https://breakbuild.dev/"> About </a> </li><li class="s90"> <a href="https://breakbuild.dev/privacy/"> Privacy </a> </li><li class="s90"> <a href="https://breakbuild.dev/contact/"> Contact </a> </li><li class="s90"> <a href="https://breakbuild.dev/sitemap.xml" target="_blank"> Sitemap </a> </li></ul>
      </nav>
    </div>
  </footer>
</body>
</html>